name : 'Plan Code'
description: 'Validation of the pipeline'
runs:
  using: "composite"
  environment:
      name: ${{ env.Env }}
  steps:
    - uses: actions/checkout@v2

    - uses: cschleiden/replace-tokens@v1
      with:
        tokenPrefix: '#{'
        tokenSuffix: '}#'
        files: '["**/parameters.yml"]'
       
       
     - uses: cschleiden/replace-tokens@v1
       with:
         tokenPrefix: '#{'
         tokenSuffix: '}#'
         files: '["**/variables.tf"]'
         
     - run: |
        cat ${{ github.workspace }}/variables.tf
        cat ${{ github.workspace }}/pipelines/parameters.yml
       shell: bash
     - name: Terraform Install
       uses: hashicorp/setup-terraform@v1
       with:
         terraform_version: 0.14.11
         
     - name: Terraform Init
       run: terraform init
     - name: Terraform Plan
       run: terraform plan
       
     - name: Terraform Apply
       run: terraform apply
